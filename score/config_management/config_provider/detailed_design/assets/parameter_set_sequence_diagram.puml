@startuml

title ConfigProvider ParameterSet Retrieval
skinparam SequenceMessageAlignment center
skinparam NoteBackgroundColor #E6F2FF

actor UserApp
participant "ParameterSet" as PS

rnote over UserApp, PS
Template T categories:
- PrimitiveType (int, bool, float, etc.)
- Array = score::cpp::pmr::vector<PrimitiveType>
- TwoDimensionalArray = score::cpp::pmr::vector< score::cpp::pmr::vector<PrimitiveType> >
Error paths return Unexpected(ConfigProviderError)
Floating point conversion may fallback via int -> float/double cast.
endrnote

UserApp -> PS : GetParameterAs<T>(parameter_name)
activate PS
alt T is PrimitiveType
    PS -> PS : GetParameterAsJsonAny(name)
    PS <-- PS : Result<ref json::Any>
    alt json::Any success
        PS -> PS : ConvertJsonAnyToType<PrimitiveType>()
        PS <-- PS : PrimitiveType | Unexpected
    else error
        PS <-- PS : Unexpected(error)
    end
else T is Array
    PS -> PS : GetParameterAsJsonAny(name)
    PS <-- PS : Result<ref json::Any>
    alt json::Any success
        PS -> PS : value.As<json::List>()
        PS <-- PS : Result<json::List>
        alt list success
            PS -> PS : ConvertJsonListToAmpVector<PrimitiveType>()
            PS <-- PS : Array<PrimitiveType> | Unexpected
        else list error
            PS <-- PS : Unexpected(ValueCastingError)
        end
    else json error
        PS <-- PS : Unexpected(error)
    end
else T is TwoDimensionalArray
    PS -> PS : GetParameterAsJsonAny(name)
    PS <-- PS : Result<ref json::Any>
    alt json::Any success
        PS -> PS : outer.As<json::List>()
        PS <-- PS : Result<json::List>
        alt outer list success
            loop each outer element
                PS -> PS : inner.As<json::List>()
                PS <-- PS : Result<json::List>
                alt inner list success
                    PS -> PS : ConvertJsonListToAmpVector<PrimitiveType>()
                    PS <-- PS : Array<PrimitiveType> | Unexpected
                else inner list error
                    PS <-- PS : Unexpected(ValueCastingError)
                end
            end
            PS <-- PS : TwoDimensionalArray<PrimitiveType>
        else outer list error
            PS <-- PS : Unexpected(ValueCastingError)
        end
    else json error
        PS <-- PS : Unexpected(error)
    end
end
UserApp <-- PS : Result<T>
deactivate PS

@enduml
